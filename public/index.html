<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Lyrics</title>

<!-- PDF LIBRARY -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root {
  --accent: #f2c94c;
  --bg: #f2f4f8;
  --text-dark: #222;
  --header-bg: #003366;
}

body{
  margin:0;
  background: var(--bg);
  font-family: Georgia, serif;
  color: var(--text-dark);
}

/* HEADER */
.header{
  position: relative;
  max-width: 900px;
  margin: 30px auto;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.15);
  padding: 30px;
}

.logo{
  position:absolute;
  top:20px;
  right:20px;
  width:60px;
  border-radius:12px;
}

/* BACK */
.back-link{
  display:inline-block;
  margin-bottom:20px;
  color:#003366;
  font-weight:bold;
  text-decoration:none;
}

/* TITLE */
.song-title{
  text-align:center;
  font-size:32px;
  font-weight:bold;
  color:#003366;
  cursor:pointer;
}
.song-title:hover{
  text-decoration: underline;
}

/* BUTTON */
.pdf-btn{
  display:block;
  margin:20px auto;
  padding:12px 20px;
  font-size:16px;
  font-weight:bold;
  background:#003366;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
.pdf-btn:hover{
  background:#002244;
}

/* IMAGE */
.song-image{
  width:100%;
  max-height:400px;
  object-fit:cover;
  border-radius:12px;
  margin:20px 0;
}

/* LYRICS */
.lyrics{
  white-space:pre-wrap;
  line-height:1.7;
  font-size:18px;
}

/* VIDEO */
.video-box iframe{
  width:100%;
  height:360px;
  border-radius:12px;
  margin-top:30px;
}

/* PDF MODE */
.pdf-mode iframe{
  display:none;
}
</style>
</head>

<body>

<div class="header" id="pdfContent">
  <img src="cross.png" class="logo">

  <a class="back-link" href="lyrics.html">← Back to All Lyrics</a>

  <h1 class="song-title" id="title" onclick="generatePDF()"></h1>

  <button class="pdf-btn" onclick="generatePDF()">⬇ Download PDF</button>

  <img id="image" class="song-image">

  <div class="lyrics" id="lyrics"></div>

  <div class="video-box" id="video"></div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

/* ✅ NEW GOOGLE SHEET */
const sheetURL =
"https://docs.google.com/spreadsheets/d/1X8XY51OIVpMX5BMsnnsEpuuYsdvRsnSxbmWFbidbTBs/gviz/tq?tqx=out:json";

fetch(sheetURL)
  .then(res => res.text())
  .then(data => {
    const json = JSON.parse(data.substring(47, data.length - 2));
    const row = json.table.rows[id].c;

    const title = row[0]?.v || "";
    const lyrics = row[1]?.v || "";
    const image = row[2]?.v || "";
    const youtube = row[3]?.v || "";

    document.getElementById("title").textContent = title;
    document.getElementById("lyrics").textContent = lyrics;
    document.getElementById("image").src = image;

    if(youtube){
      const ytId = youtube.includes("v=")
        ? youtube.split("v=")[1]
        : youtube.split(".be/")[1];

      document.getElementById("video").innerHTML =
        `<iframe src="https://www.youtube.com/embed/${ytId}" allowfullscreen></iframe>`;
    }
  });

/* PDF FUNCTION */
function generatePDF(){
  const element = document.getElementById("pdfContent");
  element.classList.add("pdf-mode");

  html2pdf().from(element).set({
    margin: 10,
    filename: document.getElementById("title").textContent + ".pdf",
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  }).save().then(()=>{
    element.classList.remove("pdf-mode");
  });
}
</script>

</body>
</html>
