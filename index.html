<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Exam & Course PDF Library</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body {
  margin: 0;
  font-family: Georgia, serif;
  background: #f2f2f2;
}

/* ===== LAYOUT ===== */
.container {
  display: flex;
  min-height: 100vh;
}

/* ===== SIDEBAR ===== */
.sidebar {
  width: 320px;
  background: #111;
  color: white;
  padding: 20px;
}

.sidebar h2 {
  margin-top: 0;
  font-size: 18px;
}

.search {
  width: 100%;
  padding: 8px;
  margin-bottom: 15px;
  border: none;
  font-size: 14px;
}

.title-link {
  padding: 10px;
  background: #222;
  margin-bottom: 8px;
  cursor: pointer;
  border-left: 4px solid transparent;
}

.title-link:hover,
.title-link.active {
  background: #333;
  border-left: 4px solid #00b894;
}

/* ===== MAIN ===== */
.main {
  flex: 1;
  padding: 30px;
}

.download-btn {
  background: #00b894;
  color: white;
  border: none;
  padding: 10px 18px;
  cursor: pointer;
  margin-bottom: 15px;
}

/* ===== PDF ===== */
.magazine {
  background: white;
  max-width: 210mm;
  margin: auto;
  padding: 30px;
  position: relative;
}

/* IMAGE WATERMARK */
.magazine::before {
  content: "";
  position: fixed;
  inset: 0;
  background: url("peron.png") repeat;
  background-size: 180px;
  opacity: 0.05;
  transform: rotate(-25deg);
}

/* TEXT WATERMARK */
.watermark {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) rotate(-30deg);
  font-size: 46px;
  font-weight: bold;
  color: rgba(0,0,0,0.08);
  pointer-events: none;
}

/* CONTENT */
.content {
  position: relative;
  z-index: 2;
}

/* TITLE */
.pdf-title {
  font-size: 30px;
  font-weight: bold;
  text-align: center;
  margin-bottom: 30px;
  border-bottom: 3px solid #000;
  padding-bottom: 10px;
}

/* QUESTIONS */
.question {
  margin-bottom: 25px;
  page-break-inside: avoid;
}

.diagram img {
  max-width: 100%;
  border: 1px solid #ccc;
  margin-top: 10px;
}
</style>
</head>

<body>

<div class="container">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h2>Available PDFs</h2>
    <input type="text" class="search" placeholder="Search..." onkeyup="filterTitles(this.value)">
    <div id="titleList"></div>
  </div>

  <!-- MAIN -->
  <div class="main">
    <button class="download-btn" onclick="downloadPDF()">Download PDF</button>

    <div class="magazine" id="pdfArea">
      <div class="watermark">www.perontips.co.ke</div>

      <div class="content">
        <div id="pdfTitle" class="pdf-title">Select a document</div>
        <div id="questions"></div>
      </div>
    </div>
  </div>

</div>

<script>
/* ===== CONFIG ===== */

const SHEET_ID = "1X8XY51OIVpMX5BMsnnsEpuuYsdvRsnSxbmWFbidbTBs";

/* ADD NEW SHEETS HERE (UNLIMITED) */
const SHEETS = [
  "Sheet1",
  "Sheet3",
  "Sheet4"
];

let currentTitle = "";
let currentSheet = "";

/* ===== LOAD TITLES ===== */

async function loadTitles() {
  const list = document.getElementById("titleList");

  for (const sheet of SHEETS) {
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${sheet}`;
    const csv = await fetch(url).then(r => r.text());
    const title = csv.split("\n")[0].split(",")[0].replace(/"/g, "");

    const div = document.createElement("div");
    div.className = "title-link";
    div.innerText = title;
    div.onclick = () => loadSheet(sheet, title, div);
    list.appendChild(div);
  }
}

/* ===== LOAD SHEET ===== */

async function loadSheet(sheet, title, el) {
  document.querySelectorAll(".title-link").forEach(d => d.classList.remove("active"));
  el.classList.add("active");

  currentSheet = sheet;
  currentTitle = title;

  document.getElementById("pdfTitle").innerText = title;

  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${sheet}`;
  const csv = await fetch(url).then(r => r.text());
  const rows = csv.split("\n").slice(1);

  const container = document.getElementById("questions");
  container.innerHTML = "";

  rows.forEach((row, i) => {
    const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
    const q = cols[0]?.replace(/"/g, "");
    const img = cols[1]?.replace(/"/g, "");

    if (!q) return;

    container.innerHTML += `
      <div class="question">
        <strong>Question ${i + 1}</strong><br>
        ${q}
        ${img ? `<div class="diagram"><img src="${img}"></div>` : ""}
      </div>
    `;
  });
}

/* ===== SEARCH ===== */

function filterTitles(text) {
  document.querySelectorAll(".title-link").forEach(d => {
    d.style.display = d.innerText.toLowerCase().includes(text.toLowerCase())
      ? "block" : "none";
  });
}

/* ===== DOWNLOAD ===== */

function downloadPDF() {
  if (!currentSheet) {
    alert("Select a document first");
    return;
  }

  html2pdf().set({
    filename: currentTitle + ".pdf",
    html2canvas: { scale: 2, useCORS: true },
    jsPDF: { format: "a4", orientation: "portrait" }
  }).from(document.getElementById("pdfArea")).save();
}

/* START */
loadTitles();
</script>

</body>
</html>
